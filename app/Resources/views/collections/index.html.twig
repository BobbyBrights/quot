{% extends 'base.html.twig' %}

{% block title %}Quot - Colecciones{% endblock %}

{% block body %}
    {% for col in collections %}
        {% if col.products is not empty %}
            <div class='row'>
                <div class='col-md-12'>
                    <div class='detail-wrapper'>
                      <h1>{{ col.title_collection }}</h1>
                        <div class="owl-carousel">
                            {% set dataCount = col.products %}
                            {% for base in col.products %}
                                {{ include('collections/partials/product-teaser.html.twig', {'data': base, 'vid_parent': col.vid }) }}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class='col-md-12'>
                    {% for base in col.products %}
                        {{ include('collections/partials/product-detail.html.twig', {'data': base, 'class': loop.revindex, 'vid_parent': col.vid }) }}
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    {% endfor %}
    <div class="modal fade white-modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content white-modal-content">
                <div class='white-modal-wrapper'>
                    <h2>Primero los primeros</h2>
                    <h3>Personalizacion</h3>
                    <p>
                      Importancia y valor a lo individual. Cada una de nuestras camisas es
                      una edicion limitada de 50 unidades
                    </p>
                    <div class='white-modal-links'>
                        <a id="link_modal_cart" href="/resumen-camisa?vidParent=4&vid=33&size=&com=0">No, Gracias</a>
                    </div> 
                    <div class='white-modal-links'>
                        <a id="link_modal" href="/personalizar/detalle?vidParent=4&vid=33&size=">Personalizar</a>
                    </div>  
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    function generateLink(vid_parent, vid){
        var size = $('.div_' + vid).children('span').text();
        window.location.assign("/personalizar/detalle?vidParent=" + vid_parent + "&vid=" + vid + "&size" + size);
        //window.location.assign("/personalizar/" + vid_parent + "/" + vid + "/" + size);
    }
    
    function generateLinkFromDetail(vid_parent, vid){
        var size = $('#div_' + vid).children('span').text();
        window.location.assign("/personalizar/" + vid_parent + "/" + vid + "/" + size);
    }

    function DropDown(el) {
        this.dd = el;
        this.initEvents();
    }
    DropDown.prototype = {
        initEvents : function() {
            var obj = this;
            obj.dd.on('click', function(event){
                $(this).toggleClass('active');
                event.stopPropagation();
            });
        }
    }
    
    function countShirt(vid_parent){
        $.ajax({
            url: "/count-shirt",
            data: {'vidParent': vid_parent },
            type: "get",
            success: function(data){
                $('#count_shirt_'+vid_parent).html(data);
            }
        });
    }
    $(document).ready(function(){
        
        $('.bk-custom').click(function () {
            data = $(this).attr('name');
            ids = data.split('-');
            $('#link_modal').attr('href', '/personalizar/detalle?vidParent=' + ids[0] + '&vid=' + ids[1] + '&size');
            $('#link_modal_cart').attr('href', '/carro-compras');
            $('#link_modal_cart').attr('name', ids[0] + '-' + ids[1] + '-' + ids[2] + '-' + ids[3]);
        });
        
        $('#link_modal_cart').click(function(){
            data = $(this).attr('name');
            info = data.split('-');
            img = $('#shirt_img_' + ids[1]).attr('src');
            $('#custom_detail').html('<div><img src="https://www.jose-aguilar.com/blog/wp-content/uploads/2012/03/loading.gif"/></div>');
            $.ajax({
                url: "/save-preorder",
                data: {
                        'size': 'M',
                        'title': ids[2],
                        'description': 'descripcion camisa comprada',
                        'value': ids[3],
                        'user_id': 1,
                        'shirt': img,
                        'vid': ids[1] ,
                        'quant': 1,
                        'vid_parent': ids[0] 
                    },
                type: "post",
                success: function(data){
                    $('#custom_detail').html('');
                    $('#purchase_count').html(data);
                }
            });
        });
        
        countArray = {{ collections|json_encode|raw }};
        products = countArray[0]['products'];
        console.log(products);
        products.forEach(function(product) {
            countShirt(product.vid);
        });
        
        var dd = new DropDown( $('.dd') );

        $(document).click(function() {
            // all dropdowns
            $('.wrapper-dropdown-5').removeClass('active');
        });

        $('.wrapper-dropdown-5 ul.dropdown li a').click(function() {
            $(this).parents('div').children('span').text($(this).text());
        });

        $(".product-teaser").hover(function(){
            $(this).children('.product-custom product-customize-link a').trigger('mouseenter');;
            $(this).children('.product-custom product-customize-cart a').trigger('mouseenter');
        },function(){
            $(this).children('.product-custom product-customize-link a').trigger('mouseenter');
            $(this).children('.product-custom product-customize-cart a').trigger('mouseenter');
        });

      $('#detail-1').carousel();
      $('#detail-2').carousel();
      $('#detail-3').carousel();
      $(".owl-carousel").owlCarousel({
         loop:true,
         margin:10,
         responsiveClass:true,
         responsive:{
           0:{
               items:1,
               nav:false
           },
           600:{
               items:3,
               nav:false
           },
           1000:{
               items:5,
               nav:false,
               loop:false
           }
         }
      });
    });
  </script>
{% endblock %}
